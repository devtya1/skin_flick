<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SkinFlick | Premium Mobile Skins</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial; margin:0; background:#0f172a; color:white; }
    header { padding:15px; background:black; display:flex; justify-content:space-between; align-items:center; }
    button { padding:10px 15px; border:none; border-radius:6px; cursor:pointer; }
    .login { background:#22c55e; }
    .logout { background:#ef4444; }
    .container { padding:30px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; }
    .card { background:#1e293b; padding:15px; border-radius:12px; }
    img { width:100%; border-radius:10px; }
    .cart-btn { background:#38bdf8; margin-top:10px; width:100%; }
    #cartBox, #checkoutBox { background:#020617; padding:20px; border-radius:12px; margin-top:30px; display:none; }
    input, textarea { width:100%; padding:10px; margin-top:10px; border-radius:6px; border:none; }
  </style>
</head>
<body>

<header>
  <h2>SkinFlick</h2>
  <div>
    <button class="login" onclick="googleLogin()">Login with Google</button>
    <button class="logout" onclick="logout()">Logout</button>
  </div>
</header>

<div class="container">
  <h2>Premium Mobile Skins</h2>
  <div id="products" class="grid"></div>

  <div id="cartBox">
    <h3>Your Cart</h3>
    <div id="cartItems"></div>
    <button onclick="checkout()">Proceed to Checkout</button>
  </div>

  <div id="checkoutBox">
    <h3>Checkout (Fake Payment)</h3>
    <input placeholder="Full Name" id="name">
    <textarea placeholder="Address" id="address"></textarea>
    <button onclick="placeOrder()">COMPLETE PAYMENT ✅</button>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCA4R4UVTPMRRsZzx3Jf-T-CzYb4bKghsI",
  authDomain: "skinflick-cbbd9.firebaseapp.com",
  databaseURL: "https://skinflick-cbbd9-default-rtdb.firebaseio.com",
  projectId: "skinflick-cbbd9",
  storageBucket: "skinflick-cbbd9.firebasestorage.app",
  messagingSenderId: "28484571424",
  appId: "1:28484571424:web:f724d1a522ec1265c10745"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
let user = null;

// ✅ LOGIN
function googleLogin(){
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
}

function logout(){
  auth.signOut();
}

// ✅ AUTH STATE
auth.onAuthStateChanged(u=>{
  user = u;
  if(u){
    alert("Logged in as " + u.displayName);
    document.getElementById("cartBox").style.display = "block";
  }
});

// ✅ LOAD PRODUCTS
function loadProducts(){
  db.collection("products").get().then(res=>{
    let html = "";
    res.forEach(doc=>{
      const d = doc.data();
      html += `
        <div class="card">
          <img src="${d.image}">
          <h3>${d.name}</h3>
          <p>₹${d.price}</p>
          <button class="cart-btn" onclick="addToCart('${doc.id}', '${d.name}', ${d.price})">Add to Cart</button>
        </div>
      `;
    });
    document.getElementById("products").innerHTML = html;
  });
}

// ✅ ADD TO CART
function addToCart(id,name,price){
  if(!user) return alert("Please login first!");
  db.collection("carts").doc(user.uid).collection("items").doc(id).set({
    name, price
  });
  alert("Added to cart ✅");
}

// ✅ VIEW CART
function viewCart(){
  db.collection("carts").doc(user.uid).collection("items").get().then(res=>{
    let html="";
    res.forEach(doc=>{
      const d = doc.data();
      html += `<p>${d.name} - ₹${d.price}</p>`;
    });
    document.getElementById("cartItems").innerHTML = html;
  });
}

// ✅ CHECKOUT
function checkout(){
  if(!user) return;
  document.getElementById("checkoutBox").style.display="block";
  viewCart();
}

// ✅ PLACE ORDER (FAKE PAYMENT)
function placeOrder(){
  const name = document.getElementById("name").value;
  const address = document.getElementById("address").value;
  if(!name || !address) return alert("Fill all fields");
  
  db.collection("orders").add({
    user: user.uid,
    name, address,
    date: new Date()
  });

  alert("Payment Successful ✅ Order Placed!");
}

// ✅ AUTO CREATE SAMPLE PRODUCTS (RUN ONLY ONCE)
db.collection("products").get().then(snap=>{
  if(snap.empty){
    db.collection("products").add({name:"Blue Carbon Skin", price:299, image:"https://i.imgur.com/0Z8YpA2.jpg"});
    db.collection("products").add({name:"Matte Black Skin", price:249, image:"https://i.imgur.com/UwL3p7E.jpg"});
    db.collection("products").add({name:"Anime Skin", price:349, image:"https://i.imgur.com/Y2uZz9o.jpg"});
  }
  loadProducts();
});
</script>

</body>
</html>
